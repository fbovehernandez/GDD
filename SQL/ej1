Use GD2015C1

/* 8. Mostrar para el o los artículos que tengan stock en todos los depósitos, nombre del
artículo, stock del depósito que más stock tiene. */

SELECT prod_detalle, max(stoc_deposito) from STOCK JOIN Producto on prod_codigo = stoc_producto
where stoc_cantidad > 0
group by stoc_producto 
having count(distinct stoc_deposito) >= (Select count(*) from DEPOSITO)


/* 9. Mostrar el código del jefe, código del empleado que lo tiene como jefe, nombre del
mismo y la cantidad de depósitos que ambos tienen asignados. */

Select empl_codigo, empl_nombre, empl_jefe, (Select isnull(count(depo_encargado),0) as cant_depo1 from DEPOSITO 
												where depo_encargado = empl_codigo
												group by depo_encargado), (Select isnull(count(depo_encargado),0) from DEPOSITO 
												where depo_encargado = empl_jefe
												group by depo_encargado)
from Empleado
where empl_jefe is not null -- Asi no me trae al final boss (el jefe de jefes,a ese no lo quiero)

-- Joineando 

select ep.empl_codigo, ep.empl_nombre, ep.empl_jefe, count(distinct d1.depo_codigo), count(distinct d2.depo_codigo)
from empleado ep
LEFT JOIN DEPOSITO d1 on ep.empl_codigo = d1.depo_encargado
JOIN DEPOSITO d2 on ep.empl_jefe = d2.depo_encargado
group by ep.empl_codigo, ep.empl_nombre, ep.empl_jefe

/* 10. Mostrar los 10 productos más vendidos en la historia y también los 10 productos menos
vendidos en la historia. Además mostrar de esos productos, quien fue el cliente que
mayor compra realizo. */

Select distinct m.item_producto, (select top 1 fact_cliente from Item_Factura f
	JOIN factura on fact_tipo+fact_sucursal+fact_numero = item_tipo+item_sucursal+item_numero
				where m.item_producto = f.item_producto
				group by fact_cliente
				order by sum(item_cantidad) desc) from Item_Factura m
where item_producto IN ((select top 10 item_producto from Item_Factura
								group by item_producto
								order by sum(item_cantidad) desc)) 
   OR item_producto IN (select top 10 item_producto from Item_Factura
								group by item_producto
								order by sum(item_cantidad) asc)
							
/* 11. Realizar una consulta que retorne el detalle de la familia, la cantidad diferentes de
productos vendidos y el monto de dichas ventas sin impuestos. Los datos se deberán
ordenar de mayor a menor, por la familia que más productos diferentes vendidos tenga,
solo se deberán mostrar las familias que tengan una venta superior a 20000 pesos para
el año 2012. */
